<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player M3U - Central de Hotéis</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Estilos básicos para o player */
        body {
            background-color: var(--color-primary, #081924);
            color: var(--color-text-primary-on-dark, #f0f0f0);
        }

        .player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 20px;
        }

        .player-layout {
            display: flex;
            flex-direction: row;
            gap: 50px;
            width: 100%;
            max-width: 1400px;
            margin: 20px auto;
        }

        .player-sidebar {
            flex: 0 0 350px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .player-main {
            flex: 1;
            min-width: 0;
        }

        .search-container {
            margin-bottom: 0;
            width: 100%;
        }

        #channelSearchInput {
            padding: 10px 10px 10px 35px;
            border: 2px solid #22d4fd;
            border-radius: 5px;
            width: 100%;
            font-size: 1em;
            box-sizing: border-box;
            background-color: #1a2b38;
            color: var(--color-text-primary-on-dark);
            background-image: url('assets/arquivos-png/Lupa.png');
            background-repeat: no-repeat;
            background-position: left 10px center;
            background-size: 16px 16px;
        }

        #channelSearchInput::placeholder {
            color: #aaa;
        }

        .player-sidebar h2 {
            color: var(--color-headings-on-dark);
            margin-bottom: 0px;
            margin-top: 0;
            font-size: 1.2em;
        }

        .channel-list-container {
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            background-color: #1a2b38;
            border: 1px solid var(--color-border-button, #22d4fd);
            border-radius: 5px;
            padding: 10px;
            color: var(--color-text-primary-on-dark);
            flex: 1;
        }

        #channelList {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .channel-item {
            padding: 8px 10px;
            cursor: pointer;
            border-bottom: 1px solid #334;
            transition: background-color 0.2s ease;
            display: list-item;
        }

        .channel-item:last-child {
            border-bottom: none;
        }

        .channel-item:hover {
            background-color: var(--color-hover-button, #1f4964);
        }

        .channel-item.active {
            background-color: #0a2840;
            font-weight: bold;
        }

        #videoPlayer {
            width: 100%;
            min-height: 500px;
            height: auto;
            aspect-ratio: 16/9;
            background-color: #000;
            border: 1px solid #333;
        }

        .player-header {
            width: 100%;
            max-width: 1400px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px auto;
            text-align: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .player-header h1 {
            margin: 0;
            font-size: 1.5em;
            color: var(--color-headings-on-dark);
        }

        .player-container h2 {
            color: var(--color-headings-on-dark);
            margin-bottom: 10px;
            margin-top: 0;
        }

        @media (max-width: 768px) {
            .player-layout {
                flex-direction: column;
                gap: 20px;
            }

            .player-sidebar {
                flex: 0 0 auto;
                width: 100%;
                max-width: 600px;
                margin: 0 auto;
            }

            #videoPlayer {
                min-height: 300px;
            }

            .player-header h1 {
                font-size: 1.3em;
            }

            .player-sidebar h2 {
                font-size: 1.2em;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>

<body>
    <header class="page-header">
        <img src="assets/arquivos-png/hoteltech-azul.png" alt="Logo Principal" class="header-logo">
        <a href="index.html" class="button voltar-button icon-button" title="Voltar">
            <img src="assets/arquivos-png/voltar.png" alt="Voltar" class="button-icon">
        </a>
    </header>

    <div class="player-container">
        <div class="player-header">

        </div>

        <div class="player-layout">

            <div class="player-sidebar">
                <h2>Lista de Canais</h2>
                <div class="search-container">
                    <input type="text" id="channelSearchInput" placeholder="Pesquisar canais na lista...">
                </div>
                <div class="channel-list-container">
                    <ul id="channelList">
                        <li>Carregando lista de canais...</li>
                    </ul>
                </div>
            </div>

            <div class="player-main">
                <video id="videoPlayer" controls autoplay style="background-color: black;">
                    Seu navegador não suporta a tag de vídeo.
                </video>
            </div>

        </div>
    </div>

    <footer class="main-footer">
        <img src="assets/arquivos-png/hoteltech-azul.png" alt="Logo Hoteltech Rodapé" class="footer-logo-main">
        <div class="footer-links">
            <a href="https://hoteltechbr.com/" target="_blank" class="footer-link"> <img
                    src="assets/arquivos-png/site.png" alt="Website" class="footer-icon"> <span>Website</span> </a>
            <a href="https://www.instagram.com/hoteltechbr?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="
                target="_blank" class="footer-link"> <img src="assets/arquivos-png/instagram.png" alt="Instagram"
                    class="footer-icon"> <span>Instagram</span> </a>
            <a href="https://linktr.ee/hoteltechbr?fbclid=PAZXh0bgNhZW0CMTEAAafA18AkjQIq8Aie0cJLg2B7Zsovwa2G9qcP_Xar2sqXgaL-te5A4iuAsop_hg_aem_rz2grfIcSKv62_8QEqrvegF"
                target="_blank" class="footer-link"> <img src="assets/arquivos-png/whatsapp.png" alt="WhatsApp"
                    class="footer-icon"> <span>WhatsApp</span> </a>
        </div>
    </footer>

    <script src="database.js"></script>
    <script>
        // Script completo do player M3U
        const channelListElement = document.getElementById('channelList');
        const videoPlayer = document.getElementById('videoPlayer');
        const searchInput = document.getElementById('channelSearchInput');
        let hlsInstance = null;
        const m3uFilePath = 'assets/upload/canais-tv.m3u';

        // Funções loadM3UFromFile, parseM3U, displayChannelList, playChannel, filterChannelList
        // (Código das funções JS permanece o mesmo, sem comentários HTML)
        async function loadM3UFromFile(filePath) { channelListElement.innerHTML = '<li>Carregando lista...</li>'; try { const response = await fetch(filePath); if (!response.ok) { throw new Error(`Erro HTTP ${response.status}: Arquivo M3U não encontrado em "${filePath}".`); } const content = await response.text(); const channels = parseM3U(content); displayChannelList(channels); } catch (error) { console.error("Erro ao carregar M3U:", error); channelListElement.innerHTML = `<li>Erro ao carregar lista: ${error.message}</li>`; } }
        function parseM3U(content) { const lines = content.split('\n'); const channels = []; let currentChannel = {}; if (!lines[0].toUpperCase().startsWith("#EXTM3U")) { console.error("M3U inválido: Falta #EXTM3U"); channelListElement.innerHTML = '<li>Arquivo M3U inválido (cabeçalho ausente).</li>'; return []; } for (let i = 0; i < lines.length; i++) { const line = lines[i].trim(); if (line.startsWith('#EXTINF:')) { currentChannel = { name: '', logo: null, group: null, url: null }; let name = line.substring(line.lastIndexOf(',') + 1); currentChannel.name = name.trim(); const attributesMatch = line.match(/([a-zA-Z0-9\-]+)="([^"]*)"/g); if (attributesMatch) { attributesMatch.forEach(attr => { const parts = attr.match(/([a-zA-Z0-9\-]+)="([^"]*)"/); if (parts && parts.length >= 3) { const key = parts[1].toLowerCase(); const value = parts[2]; if (key === 'tvg-logo') { currentChannel.logo = value; } else if (key === 'group-title') { currentChannel.group = value; } } }); } } else if (currentChannel.name && !line.startsWith('#') && (line.startsWith('http://') || line.startsWith('https://'))) { currentChannel.url = line; channels.push(currentChannel); currentChannel = {}; } } console.log("Canais parseados:", channels.length); return channels; }
        function displayChannelList(channels) { channelListElement.innerHTML = ''; if (!channels || channels.length === 0) { if (document.querySelector('#channelList li')?.textContent !== 'Arquivo M3U inválido (cabeçalho ausente).') { channelListElement.innerHTML = '<li>Nenhum canal encontrado ou formato não reconhecido.</li>'; } return; } channels.forEach(channel => { const li = document.createElement('li'); li.classList.add('channel-item'); let displayText = channel.name || 'Canal sem nome'; li.textContent = displayText; li.dataset.url = channel.url; li.addEventListener('click', () => { playChannel(channel.url); document.querySelectorAll('.channel-item.active').forEach(el => el.classList.remove('active')); li.classList.add('active'); }); channelListElement.appendChild(li); }); }
        function playChannel(url) { if (!url) { console.error("URL inválida."); return; } console.log("Tentando tocar:", url); if (hlsInstance) { hlsInstance.destroy(); hlsInstance = null; console.log("Instância HLS anterior destruída."); } if (url.toLowerCase().includes('.m3u8') && typeof Hls !== 'undefined' && Hls.isSupported()) { console.log("Stream HLS -> Usando hls.js"); hlsInstance = new Hls(); hlsInstance.loadSource(url); hlsInstance.attachMedia(videoPlayer); hlsInstance.on(Hls.Events.MANIFEST_PARSED, function () { videoPlayer.play().catch(e => console.error("Erro play() HLS:", e)); }); hlsInstance.on(Hls.Events.ERROR, function (event, data) { console.error('HLS.js Error:', data); if (data.fatal) { switch (data.type) { case Hls.ErrorTypes.NETWORK_ERROR: hlsInstance.startLoad(); break; case Hls.ErrorTypes.MEDIA_ERROR: hlsInstance.recoverMediaError(); break; default: hlsInstance.destroy(); break; } } }); } else { console.log("Stream não-HLS ou Hls.js indisponível/não suportado -> Tentando player nativo."); try { if (url.toLowerCase().includes('.m3u8') && !videoPlayer.canPlayType('application/vnd.apple.mpegurl') && !videoPlayer.canPlayType('application/x-mpegURL')) { console.warn("Navegador pode não suportar HLS nativamente."); } videoPlayer.src = url; videoPlayer.load(); videoPlayer.play().catch(e => console.error("Erro play() nativo:", e)); } catch (err) { console.error("Erro ao definir src ou tocar vídeo:", err); } } videoPlayer.onerror = (e) => { console.error("Erro geral no elemento <video>:", videoPlayer.error, e); }; }
        function filterChannelList() { const searchTerm = searchInput.value.toLowerCase(); const channelItems = channelListElement.querySelectorAll('.channel-item'); channelItems.forEach(item => { const channelName = item.textContent.toLowerCase(); item.style.display = channelName.includes(searchTerm) ? '' : 'none'; }); }

        // Lógica Principal ao Carregar a Página
        window.addEventListener('DOMContentLoaded', (event) => {
            console.log('Player DOM carregado.');
            searchInput.addEventListener('input', filterChannelList);
            loadM3UFromFile(m3uFilePath);
        });
    </script>

</body>

</html>